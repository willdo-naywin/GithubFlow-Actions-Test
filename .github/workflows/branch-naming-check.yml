name: Branch Naming Check

on:
  pull_request:
    branches:
      - main
      - master
    types: [opened, synchronize, reopened, edited]

permissions:
  contents: read
  pull-requests: write

jobs:
  validate-branch-name:
    name: Validate Branch Name
    runs-on: ubuntu-latest
    steps:
      - name: Check branch naming convention
        id: validate
        run: |
          BRANCH_NAME="${{ github.head_ref }}"
          BASE_BRANCH="${{ github.base_ref }}"
   
          if [[ "$BRANCH_NAME" =~ ^(release-|hotfix-) ]]; then
            echo "âœ… ãƒ–ãƒ©ãƒ³ãƒåã¯æœ‰åŠ¹ã§ã™: $BRANCH_NAME"
              exit 0
          else
            echo "âŒ ã‚¨ãƒ©ãƒ¼: ç„¡åŠ¹ãªãƒ–ãƒ©ãƒ³ãƒå: $BRANCH_NAME"
            echo "$BASE_BRANCH ã¸ãƒãƒ¼ã‚¸ã™ã‚‹éš›ã¯ã€ãƒ–ãƒ©ãƒ³ãƒåã¯ 'release-' ã¾ãŸã¯ 'hotfix-' ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™"
            exit 1
          fi
          
      
      - name: Comment on PR
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            const branchName = '${{ github.head_ref }}';
            const baseBranch = '${{ github.base_ref }}';
            
            const comment = `## âŒ ãƒ–ãƒ©ãƒ³ãƒåæ¤œè¨¼ãŒå¤±æ•—ã—ã¾ã—ãŸ
            
            **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ–ãƒ©ãƒ³ãƒ:** \`${baseBranch}\`  
            **ã‚½ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒ:** \`${branchName}\`
            
            ### ğŸš« å•é¡Œ
            \`${baseBranch}\` ã¸ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€ã‚½ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒåãŒä»¥ä¸‹ã®ã„ãšã‚Œã‹ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
            - \`release-\` ãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã®å ´åˆ
            - \`hotfix-\` ãƒ›ãƒƒãƒˆãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒ–ãƒ©ãƒ³ãƒã®å ´åˆ
            
            ### âœ… æœ‰åŠ¹ãªä¾‹
            - \`release-1.0.0\` â†’ \`${baseBranch}\`
            - \`release-v2.5.1\` â†’ \`${baseBranch}\`
            - \`hotfix-security-patch\` â†’ \`${baseBranch}\`
            - \`hotfix-critical-bug-fix\` â†’ \`${baseBranch}\`
            
            ### ğŸ”§ å¿…è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
            ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ï¼š
            1. ãƒ–ãƒ©ãƒ³ãƒåã‚’å‘½åè¦å‰‡ã«å¾“ã£ã¦ãƒªãƒãƒ¼ãƒ ã™ã‚‹
            2. ã“ã®PRã®ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã‚’ä¿è­·ã•ã‚Œã¦ã„ãªã„ãƒ–ãƒ©ãƒ³ãƒã«å¤‰æ›´ã™ã‚‹
            
            ---
            *ã“ã®ãƒã‚§ãƒƒã‚¯ã¯ \`main\` ã¾ãŸã¯ \`master\` ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦è‡ªå‹•çš„ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚*`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });
